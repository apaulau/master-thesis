df$point <- gsub("мядельская лука", "Мядельская-Лука", df$point, ignore.case = TRUE)
## Transform: 'Литораль-1', 'Пелагиаль-4' -> 'Станция-1', 'Станция-4'
df$point <- gsub("^[а-яА-Я\\-]+(\\d+)$", "Станция-\\1", df$point, ignore.case = TRUE)
df$point <- as.factor(df$point)
## Remove transparency variable as it has so few observations
df$transparency <- NULL
## Extract only data for horizont = 3
batorino.h3 <- df[df$horizont == 3, ]
## Because of data absence in period from start till 1972 extract the rest
batorino.h3 <- batorino.h3[year(batorino.h3$date) > 1972, ]
head(batorino.h3)
unique(batorino.h3$point)
unique(batorino.h3$depth)
batorino.h3
batorino.h3$date
batorino.h3$date[1]
df <- data.frame(
date = today() + days(1:300),
x = runif(300)
)
df
df$my <- floor_date(df$date, "month")
df
?aggregate
state.x77
aggregate(state.x77, list(Region = state.region), mean)
floor_date(batorino.h3$date, "month")
batorino.h3$date <- floor_date(batorino.h3$date, "month")
head(batorino.h3)
batorino.h3$horizont <- NULL
head(batorino.h3)
aggregate(batorino.h3, list(date = batorino.h3$date), mean)
warnings()
head(batorino.h3)
batorino.h3
head(batorino.h3)
length(batorino.h3)
length(batorino.h3[1])
length(batorino.h3[,1])
batorino.h3[1]
batorino.h3[[1]]
aggregate(batorino.h3, list(date = batorino.h3$date, point = batorino.h3$point), mean)
head(batorino.h3)
aggregate(batorino.h3, list(date = batorino.h3$date, point = batorino.h3$point))
aggregate(batorino.h3, list(date = batorino.h3$date, point = batorino.h3$point), print)
aggregate(batorino.h3, list(date = batorino.h3$date, point = batorino.h3$point), sum)
aggregate(batorino.h3, list(date = batorino.h3$date), mean)
aggregate(batorino.h3, list(date = batorino.h3$date, point = batorino.h3$point), sum)
aggregate(batorino.h3, list(date = batorino.h3$date, point = batorino.h3$point), mean)
batorino.h3
rows(batorino.h3)
batorino.h3[1]
length(batorino.h3[1])
length(batorino.h3[[1]])
batorino.h3$point <- NULL
batorino.h3
97.2/4
batorino.h3$date <- floor_date(batorino.h3$date, "month")
aggregate(batorino.h3, by=list(date = batorino.h3$date), mean)
batorino.h3[is.na(batorino.h3$o2solubility)]
is.na(batorino.h3$o2solubility)
batorino.h3[true]
batorino.h3[T]
batorino.h3[T,T]
is.na(batorino.h3$o2solubility)
batorino.h3[is.na(batorino.h3$o2solubility)]
batorino.h3[[is.na(batorino.h3$o2solubility)]]
batorino.h3[is.na(batorino.h3$o2solubility),]
batorino.aggregated <- aggregate(batorino.h3, by = list(date = batorino.h3$date), mean)
batorino.aggregated[is.na(batorino.aggregated$o2solubility),]
batorino.aggregated[is.na(batorino.aggregated$temperature),]
batorino.h3[is.na(batorino.h3$temperature),]
batorino.h3
batorino.aggregated <- aggregate(batorino.h3, by = list(date = batorino.h3$date), mean)
batorino.aggregated
batorino.aggregated <- aggregate(batorino.h3, by = list(batorino.h3$date), mean)
batorino.aggregated
batorino.aggregated <- aggregate(batorino.h3, by = list(group = batorino.h3$date), mean)
batorino.aggregated$group <- NULL
head(batorino.aggregated)
unique(batorino.h3$depth)
unique(batorino.aggregated$depth)
batorino.aggregated[month(batorino.aggregated$date) == 06 ,]
dim(batorino.aggregated[month(batorino.aggregated$date) == 06 ,])
dim(batorino.aggregated[month(batorino.aggregated$date) == 01 ,])
dim(batorino.aggregated[month(batorino.aggregated$date) == 01 ,])[1]
dim(batorino.aggregated[month(batorino.aggregated$date) == 02 ,])[1]
dim(batorino.aggregated[month(batorino.aggregated$date) == 03 ,])[1]
dim(batorino.aggregated[month(batorino.aggregated$date) == 04 ,])[1]
dim(batorino.aggregated[month(batorino.aggregated$date) == 05 ,])[1]
dim(batorino.aggregated[month(batorino.aggregated$date) == 06 ,])[1]
dim(batorino.aggregated[month(batorino.aggregated$date) == 07 ,])[1]
dim(batorino.aggregated[month(batorino.aggregated$date) == 08 ,])[1]
dim(batorino.aggregated[month(batorino.aggregated$date) == 09 ,])[1]
dim(batorino.aggregated[month(batorino.aggregated$date) == 10 ,])[1]
dim(batorino.aggregated[month(batorino.aggregated$date) == 11 ,])[1]
dim(batorino.aggregated[month(batorino.aggregated$date) == 12 ,])[1]
dim(batorino.aggregated[month(batorino.aggregated$date) == 07 ,])[1]
1:12
sapply(1:12, function(x) dim(batorino.aggregated[month(batorino.aggregated$date) == x, ])[1])
obsByNums <- sapply(1:12, function(x) dim(batorino.aggregated[month(batorino.aggregated$date) == x, ])[1])
mostVoluminousMonth <- which.max(obsByNums)
mostVoluminousMonth
dataset <- batorino.aggregated[month(batorino.aggregated$date == mostVoluminousMonth), ]
dataset <- batorino.aggregated[month(batorino.aggregated$date) == mostVoluminousMonth, ]
dataset
batorino.aggregated
dataset
head(dataset)
batorino.aggregated[year(batorino.aggregated$date)==1974,]
batorino.aggregated.1974 <- batorino.aggregated[year(batorino.aggregated$date)==1974,]
batorino.aggregated.1974 <- batorino.aggregated[year(batorino.aggregated$date) == 1974, ]
batorino.aggregated.1974 <- batorino.aggregated.1974[month(batorino.aggregated.1974$date) == 06 || month(batorino.aggregated.1974$date) == 08, ]
batorino.aggregated.1974
batorino.aggregated.1974 <- batorino.aggregated[year(batorino.aggregated$date) == 1974, ]
batorino.aggregated.1974
batorino.aggregated.1974 <- batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 || month(batorino.aggregated.1974$date) == 08), ]
batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 || month(batorino.aggregated.1974$date) == 08), ]
batorino.aggregated.1974 <- batorino.aggregated[year(batorino.aggregated$date) == 1974, ]
batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 || month(batorino.aggregated.1974$date) == 08), ]
batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 , ]
batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06, ]
batorino.aggregated.1974[month(batorino.aggregated.1974$date) == 06, ]
batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 | month(batorino.aggregated.1974$date) == 08), ]
mean(batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 | month(batorino.aggregated.1974$date) == 08), ])
mean(batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 | month(batorino.aggregated.1974$date) == 08), ], -c("date"))
batorino.aggregated.1974
batorino.aggregated.1974[, c("date")]
batorino.aggregated.1974[, -c("date")]
batorino.aggregated.1974[, c(-"date")]
batorino.aggregated.1974[, c(F)]
batorino.aggregated.1974[, -c(F)]
batorino.aggregated.1974[, c(T)]
batorino.aggregated.1974[, c(T,F)]
batorino.aggregated.1974[, c(F,T)]
mean(batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 | month(batorino.aggregated.1974$date) == 08), ], c(FALSE, TRUE, TRUE, TRUE))
rowMeans(batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 | month(batorino.aggregated.1974$date) == 08), -1])
batorino.aggregated.1974[, -1]
batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 | month(batorino.aggregated.1974$date) == 08), ]
batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 | month(batorino.aggregated.1974$date) == 08), -1]
mean(batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 | month(batorino.aggregated.1974$date) == 08), -1])
rowMeans(batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 | month(batorino.aggregated.1974$date) == 08), -1])
colMeans(batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 | month(batorino.aggregated.1974$date) == 08), -1])
rowMeans(batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 | month(batorino.aggregated.1974$date) == 08), -1])$date = "1974-07-01"
colMeans(batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 | month(batorino.aggregated.1974$date) == 08), -1])$date = "1974-07-01"
colMeans(batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 | month(batorino.aggregated.1974$date) == 08), -1])
a <- colMeans(batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 | month(batorino.aggregated.1974$date) == 08), -1])
a
class(a)
a[1]
a$depth
cbind(a, "1974-07-01")
rbind(a, "1974-07-01")
cbind(a, "1974-07-01")
c(a, "1974-07-01")
c("1974-07-01", a)
c(date="1974-07-01", a)
c(date=date("1974-07-01"), a)
c(date="1974-07-01", a)
list(date="1974-07-01", a)
data.frame(date="1974-07-01", a)
as.data.frame(a)
cbind(read.table(text = name(a)), a)
cbind(read.table(text = names(a)), a)
a
a
cbind(read.table(text = names(a)), a)
rbind(read.table(text = names(a)), a)
cbind(read.table(text = names(a)), a)
d <- cbind(read.table(text = names(a)), a)
d$a
data.frame(c(date('1974-07-01', d$a), col.names = c('date', d$V1)))
data.frame(c(date('1974-07-01'), d$a), col.names = c('date', d$V1)))
data.frame(c(date('1974-07-01'), d$a), col.names = c('date', d$V1))
d$V1
as.character(d$V1)
data.frame(c(date('1974-07-01'), d$a), col.names = c('date', as.character(d$V1)))
c(date('1974-07-01'), d$a)
date('1974-07-01')
date('1974-07-01')
c(c(date('1974-07-01')), d$a)
c(1, c(1,2,3))
c('1974-07-01'), d$a)
c('1974-07-01', d$a)
data.frame('1974-07-01', d$a), col.names = c('date', as.character(d$V1)))
data.frame(c('1974-07-01', d$a), col.names = c('date', as.character(d$V1)))
d <- data.frame(c('1974-07-01', d$a))
d
d <- cbind(read.table(text = names(a)), a)
d
d <- rbind(date='1974-07-1', cbind(read.table(text = names(a)), a))
rbind(date='1974-07-1', cbind(read.table(text = names(a)), a))
t(rbind(date='1974-07-1', cbind(read.table(text = names(a)), a)))
data.frame(date="1974-07-01", a)
cbind(a, "1974-07-01")
rbind(a, "1974-07-01")
c("1974-07-01", a)
c(date="1974-07-01", a)
data.frame(c(date="1974-07-01", a))
data.frame(rbind(c(date="1974-07-01", a)))
rbind(c(date="1974-07-01", a))
data.frame(rbind(c(date="1974-07-01", a)))
data.frame(rbind(c(date="1974-07-01", colMeans(batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 | month(batorino.aggregated.1974$date) == 08), -1]))))
batorino.aggregated.1974.july <- data.frame(rbind(c(date = "1974-07-01", colMeans(batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 | month(batorino.aggregated.1974$date) == 08), -1]))))
rbind(dataset, batorino.aggregated.1974.july)
library(xlsx)
library(ggplot2)
library(lubridate)
df <- read.xlsx2('data/ndb1955-2012.xls', sheetName = 'Баторино_ред', endRow = 1300,
colIndex = 1:8, colClasses = c("Date", "character", rep("numeric", 6)))
colnames(df) <- c('date', 'point', 'depth', 'transparency', 'horizont', 'temperature', 'o2solubility', 'saturation')
# Cleaning data
df$point <- trimws(df$point)
## Transform: 'Литораль, ст.1' -> 'Литораль-1'
df$point <- gsub("\\, ст\\. (\\d+)$", "\\-\\1", df$point, ignore.case = TRUE)
## Transform: 'Лит_15_исток р.Дро' -> 'Литораль-15'
df$point <- gsub("^Лит_[а-я\\. ]*(\\d+)(.*)", "Литораль-\\1", df$point)
## Liquidate leading zero
df$point <- gsub("0(\\d)", "\\1", df$point)
## Transform: 'ст.6' -> 'Станция-6'
df$point <- gsub("ст[\\.\\-](\\d+)", "Станция-\\1", df$point, ignore.case = TRUE)
## Transform: Мядель
df$point <- gsub("Мядель-1", "Мядель", df$point, ignore.case = TRUE)
df$point <- gsub("мялель", "Мядель", df$point, ignore.case = TRUE)
df$point <- gsub("мядельская лука", "Мядельская-Лука", df$point, ignore.case = TRUE)
## Transform: 'Литораль-1', 'Пелагиаль-4' -> 'Станция-1', 'Станция-4'
df$point <- gsub("^[а-яА-Я\\-]+(\\d+)$", "Станция-\\1", df$point, ignore.case = TRUE)
df$point <- as.factor(df$point)
## Remove transparency variable as it has so few observations
df$transparency <- NULL
## Extract only data for horizont = 3
batorino.h3 <- df[df$horizont == 3, ]
## Because of data absence in period from start till 1972 extract the rest
batorino.h3 <- batorino.h3[year(batorino.h3$date) > 1972, ]
## As we extracted data with horizont=3 there's no need in this variable
batorino.h3$horizont <- NULL
## Also maybe there is no sense in point variable as it could the same sensor but with different name
batorino.h3$point <- NULL
## Rounding dates down to the nearest month for further aggregating (because we wanna study data by months)
batorino.h3$date <- floor_date(batorino.h3$date, "month")
batorino.aggregated <- aggregate(batorino.h3, by = list(group = batorino.h3$date), mean)
batorino.aggregated$group <- NULL
## Count nums of observation each month
obsByNums <- sapply(1:12, function(x) dim(batorino.aggregated[month(batorino.aggregated$date) == x, ])[1])
mostVoluminousMonth <- which.max(obsByNums)
dataset <- batorino.aggregated[month(batorino.aggregated$date) == mostVoluminousMonth, ]
## I found that there is gap between 73 and 75 years. So it seems we can have mean mean of neighborhood months for this year
batorino.aggregated.1974 <- batorino.aggregated[year(batorino.aggregated$date) == 1974, ]
batorino.aggregated.1974.july <- data.frame(rbind(c(date = "1974-07-01", colMeans(batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 | month(batorino.aggregated.1974$date) == 08), -1]))))
dataset
batorino.aggregated.1974.july
rbind(dataset, batorino.aggregated.1974.july)
dataset <- rbind(dataset, batorino.aggregated.1974.july)
dataset[order(dataset$date),]
dataset <- rbind(dataset, batorino.aggregated.1974.july)
dataset <- dataset[order(dataset$date),]
dataset
batorino.h3[is.na(batorino.h3$temperature)]
batorino.h3[is.na(batorino.h3$temperature),]
batorino.h3
batorino.h3[month(batorino.h3$date) == 6,]
batorino.aggregated[month(batorino.aggregated$date) == 6,]
dataset
batorino.aggregated[month(batorino.aggregated$date) == 7,]
dim(dataset)
ggplot(dataset) + geom_line(aes(date, temperature, col = o2solubility))
ggplot(dataset) + geom_line(aes(date, temperature))
dataset
ggplot(batorino.h3[month(batorino.h3$date) == 7, ]) + geom_line(aes(date, temperature, col = o2solubility))
dataset
batorino.h3[month(batorino.h3$date) == 7, ]
dataset
dataset <- batorino.aggregated[month(batorino.aggregated$date) == mostVoluminousMonth, ]
batorino.aggregated.1974 <- batorino.aggregated[year(batorino.aggregated$date) == 1974, ]
batorino.aggregated.1974.july <- data.frame(rbind(c(date = "1974-07-01", colMeans(batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 | month(batorino.aggregated.1974$date) == 08), -1]))))
dataset <- data.frame(rbind(dataset, batorino.aggregated.1974.july))
dataset <- dataset[order(dataset$date),]
dataset
dataset$temperature
dataset <- batorino.aggregated[month(batorino.aggregated$date) == mostVoluminousMonth, ]
dataset
dataset$temperature
data.frame(rbind(c(date = "1974-07-01", colMeans(batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 | month(batorino.aggregated.1974$date) == 08), -1]))))
data.frame( colMeans(batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 | month(batorino.aggregated.1974$date) == 08), -1]))
data.frame(rbind(colMeans(batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 | month(batorino.aggregated.1974$date) == 08), -1])))
data.frame(rbind(colMeans(batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 | month(batorino.aggregated.1974$date) == 08), -1])))$temperature
data.frame(rbind(colMeans(batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 | month(batorino.aggregated.1974$date) == 08), -1])))
d <- data.frame(rbind(colMeans(batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 | month(batorino.aggregated.1974$date) == 08), -1])))
d
d$date
d$date <- "1974-01-01"
d
dataset <- data.frame(rbind(dataset, d))
dataset
df <- read.xlsx2('data/ndb1955-2012.xls', sheetName = 'Баторино_ред', endRow = 1300,
colIndex = 1:8, colClasses = c("Date", "character", rep("numeric", 6)))
colnames(df) <- c('date', 'point', 'depth', 'transparency', 'horizont', 'temperature', 'o2solubility', 'saturation')
# Cleaning data
df$point <- trimws(df$point)
## Transform: 'Литораль, ст.1' -> 'Литораль-1'
df$point <- gsub("\\, ст\\. (\\d+)$", "\\-\\1", df$point, ignore.case = TRUE)
## Transform: 'Лит_15_исток р.Дро' -> 'Литораль-15'
df$point <- gsub("^Лит_[а-я\\. ]*(\\d+)(.*)", "Литораль-\\1", df$point)
## Liquidate leading zero
df$point <- gsub("0(\\d)", "\\1", df$point)
## Transform: 'ст.6' -> 'Станция-6'
df$point <- gsub("ст[\\.\\-](\\d+)", "Станция-\\1", df$point, ignore.case = TRUE)
## Transform: Мядель
df$point <- gsub("Мядель-1", "Мядель", df$point, ignore.case = TRUE)
df$point <- gsub("мялель", "Мядель", df$point, ignore.case = TRUE)
df$point <- gsub("мядельская лука", "Мядельская-Лука", df$point, ignore.case = TRUE)
## Transform: 'Литораль-1', 'Пелагиаль-4' -> 'Станция-1', 'Станция-4'
df$point <- gsub("^[а-яА-Я\\-]+(\\d+)$", "Станция-\\1", df$point, ignore.case = TRUE)
df$point <- as.factor(df$point)
## Remove transparency variable as it has so few observations
df$transparency <- NULL
## Extract only data for horizont = 3
batorino.h3 <- df[df$horizont == 3, ]
## Because of data absence in period from start till 1972 extract the rest
batorino.h3 <- batorino.h3[year(batorino.h3$date) > 1972, ]
## As we extracted data with horizont=3 there's no need in this variable
batorino.h3$horizont <- NULL
## Also maybe there is no sense in point variable as it could the same sensor but with different name
batorino.h3$point <- NULL
## Rounding dates down to the nearest month for further aggregating (because we wanna study data by months)
batorino.h3$date <- floor_date(batorino.h3$date, "month")
batorino.aggregated <- aggregate(batorino.h3, by = list(group = batorino.h3$date), mean)
batorino.aggregated$group <- NULL
## Count nums of observation each month
obsByNums <- sapply(1:12, function(x) dim(batorino.aggregated[month(batorino.aggregated$date) == x, ])[1])
mostVoluminousMonth <- which.max(obsByNums)
dataset <- batorino.aggregated[month(batorino.aggregated$date) == mostVoluminousMonth, ]
## I found that there is gap between 73 and 75 years. So it seems we can have mean mean of neighborhood months for this year
## Get observations in 1974
batorino.aggregated.1974 <- batorino.aggregated[year(batorino.aggregated$date) == 1974, ]
## Get mean between june and august
batorino.aggregated.1974.july <- data.frame(rbind(colMeans(batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 | month(batorino.aggregated.1974$date) == 08), -1])))
dataset
d
batorino.aggregated.1974.july
batorino.aggregated.1974.july$date <- date('1974-07-01')
batorino.aggregated.1974.july
dataset <- data.frame(rbind(dataset, batorino.aggregated.1974.july))
dataset
dataset <- dataset[order(dataset$date),]
dataset
rownames(dataset)
rownames(dataset) <- 1:dim(dataset)[1]
dataset
library(xlsx)
library(ggplot2)
library(lubridate)
df <- read.xlsx2('data/ndb1955-2012.xls', sheetName = 'Баторино_ред', endRow = 1300,
colIndex = 1:8, colClasses = c("Date", "character", rep("numeric", 6)))
colnames(df) <- c('date', 'point', 'depth', 'transparency', 'horizont', 'temperature', 'o2solubility', 'saturation')
# Cleaning data
df$point <- trimws(df$point)
## Transform: 'Литораль, ст.1' -> 'Литораль-1'
df$point <- gsub("\\, ст\\. (\\d+)$", "\\-\\1", df$point, ignore.case = TRUE)
## Transform: 'Лит_15_исток р.Дро' -> 'Литораль-15'
df$point <- gsub("^Лит_[а-я\\. ]*(\\d+)(.*)", "Литораль-\\1", df$point)
## Liquidate leading zero
df$point <- gsub("0(\\d)", "\\1", df$point)
## Transform: 'ст.6' -> 'Станция-6'
df$point <- gsub("ст[\\.\\-](\\d+)", "Станция-\\1", df$point, ignore.case = TRUE)
## Transform: Мядель
df$point <- gsub("Мядель-1", "Мядель", df$point, ignore.case = TRUE)
df$point <- gsub("мялель", "Мядель", df$point, ignore.case = TRUE)
df$point <- gsub("мядельская лука", "Мядельская-Лука", df$point, ignore.case = TRUE)
## Transform: 'Литораль-1', 'Пелагиаль-4' -> 'Станция-1', 'Станция-4'
df$point <- gsub("^[а-яА-Я\\-]+(\\d+)$", "Станция-\\1", df$point, ignore.case = TRUE)
df$point <- as.factor(df$point)
## Remove transparency variable as it has so few observations
df$transparency <- NULL
## Extract only data for horizont = 3
batorino.h3 <- df[df$horizont == 3, ]
## Because of data absence in period from start till 1972 extract the rest
batorino.h3 <- batorino.h3[year(batorino.h3$date) > 1972, ]
## As we extracted data with horizont=3 there's no need in this variable
batorino.h3$horizont <- NULL
## Also maybe there is no sense in point variable as it could the same sensor but with different name
batorino.h3$point <- NULL
## Rounding dates down to the nearest month for further aggregating (because we wanna study data by months)
batorino.h3$date <- floor_date(batorino.h3$date, "month")
batorino.aggregated <- aggregate(batorino.h3, by = list(group = batorino.h3$date), mean)
batorino.aggregated$group <- NULL
## Count nums of observation each month
obsByNums <- sapply(1:12, function(x) dim(batorino.aggregated[month(batorino.aggregated$date) == x, ])[1])
mostVoluminousMonth <- which.max(obsByNums)
dataset <- batorino.aggregated[month(batorino.aggregated$date) == mostVoluminousMonth, ]
## I found that there is gap between 73 and 75 years. So it seems we can have mean mean of neighborhood months for this year
## Get observations in 1974
batorino.aggregated.1974 <- batorino.aggregated[year(batorino.aggregated$date) == 1974, ]
## Get mean between june and august
batorino.aggregated.1974.july <- data.frame(rbind(colMeans(batorino.aggregated.1974[(month(batorino.aggregated.1974$date) == 06 | month(batorino.aggregated.1974$date) == 08), -1])))
batorino.aggregated.1974.july$date <- date('1974-07-01')
dataset
dataset <- data.frame(rbind(dataset, batorino.aggregated.1974.july))
dataset
dataset <- dataset[order(dataset$date),]
dataset
rownames(dataset) <- 1:dim(dataset)[1]
dataset
dataset
ggplot(dataset) + geom_line(aes(date, temperature))
ggplot(dataset) + geom_line(aes(date, temperature, col = o2solubility))
ggplot(dataset) + geom_line(aes(date, temperature, col = o2solubility))
ggplot(dataset) + geom_line(aes(date, temperature, col = saturation))
ggplot(dataset) + geom_line(aes(date, saturation, col = temperature))
ggplot(dataset) + geom_line(aes(date, o2solubility, col = temperature))
ggplot(dataset) + geom_line(aes(saturation, o2solubility, col = temperature))
ggplot(dataset) + geom_line(aes(temperature, o2solubility, col = temperature))
ggplot(dataset) + geom_line(aes(temperature, saturation, col = temperature))
ggplot(dataset) + geom_line(aes(temperature, saturation, col = o2solubility))
rm(list = ls(all.names = TRUE))
source('~/uni/master-thesis/R/getdata.R')
df
head(df)
cleanPointNames <- function(df) {
df$point <- trimws(df$point)
## Transform: 'Литораль, ст.1' -> 'Литораль-1'
df$point <- gsub("\\, ст\\. (\\d+)$", "\\-\\1", df$point, ignore.case = TRUE)
## Transform: 'Лит_15_исток р.Дро' -> 'Литораль-15'
df$point <- gsub("^Лит_[а-я\\. ]*(\\d+)(.*)", "Литораль-\\1", df$point)
## Liquidate leading zero
df$point <- gsub("0(\\d)", "\\1", df$point)
## Transform: 'ст.6' -> 'Станция-6'
df$point <- gsub("ст[\\.\\-](\\d+)", "Станция-\\1", df$point, ignore.case = TRUE)
## Transform: Мядель
df$point <- gsub("Мядель-1", "Мядель", df$point, ignore.case = TRUE)
df$point <- gsub("мялель", "Мядель", df$point, ignore.case = TRUE)
df$point <- gsub("мядельская лука", "Мядельская-Лука", df$point, ignore.case = TRUE)
## Transform: 'Литораль-1', 'Пелагиаль-4' -> 'Станция-1', 'Станция-4'
df$point <- gsub("^[а-яА-Я\\-]+(\\d+)$", "Станция-\\1", df$point, ignore.case = TRUE)
df$point <- as.factor(df$point)
return(df)
}
df <- read.xlsx2('data/ndb1955-2012.xls', sheetName = 'Баторино_ред', endRow = 1300,
colIndex = 1:8, colClasses = c("Date", "character", rep("numeric", 6)))
colnames(df) <- c('date', 'point', 'depth', 'transparency', 'horizont', 'temperature', 'o2solubility', 'saturation')
df <- cleanPointNames(df)
## Remove transparency variable as it has so few observations
df$transparency <- NULL
batorino.h3 <- df[df$horizont == 3, ]
batorino.h3$horizont <- NULL
batorino.h3$date <- floor_date(batorino.h3$date, "month")
batorino.aggregated <- aggregate(batorino.h3, by = list(group = batorino.h3$date), mean)
batorino.h3$point <- NULL
batorino.h3$date <- floor_date(batorino.h3$date, "month")
batorino.aggregated <- aggregate(batorino.h3, by = list(group = batorino.h3$date), mean)
batorino.aggregated$group <- NULL
batorino.aggregated
dim(batorino.aggregated[month(batorino.aggregated$date) == 06 ,])
dim(batorino.aggregated[month(batorino.aggregated$date) == 07 ,])
obsByNums <- sapply(1:12, function(x) dim(batorino.aggregated[month(batorino.aggregated$date) == x, ])[1])
mostVoluminousMonth <- which.max(obsByNums)
mostVoluminousMonth
dataset <- batorino.aggregated[month(batorino.aggregated$date) == mostVoluminousMonth, ]
dataset
batorino.aggregated[year(batorino.aggregated$date) < 1971, ]
unique(batorino.aggregated)
complete.cases(batorino.aggregated)
batorino.aggregated[, c(1,3)]
complete.cases(batorino.aggregated[, c(1,3)])
batorino.aggregated[complete.cases(batorino.aggregated[, c(1,3)]),]
obsByNums
batorino.aggregated[month(batorino.aggregated$date) == 1 & complete.cases(batorino.aggregated[, c(1,3)]), ]
batorino.aggregated[month(batorino.aggregated$date) == 1, ]
obsByMonth <- sapply(1:12, function(x) dim(batorino.aggregated[month(batorino.aggregated$date) == x & complete.cases(batorino.aggregated[, c(1,3)]), ])[1])
mostVoluminousMonth <- which.max(obsByMonth)
mostVoluminousMonth
obsByMonth
dataset <- batorino.aggregated[month(batorino.aggregated$date) == mostVoluminousMonth, ]
dataset
dataset <- batorino.aggregated[month(batorino.aggregated$date) == 7, ]
dataset
batorino.aggregated[month(batorino.aggregated$date) == 6, ]
batorino.aggregated[month(batorino.aggregated$date) == 6, 3]
batorino.aggregated[month(batorino.aggregated$date) == 8, 3] - batorino.aggregated[month(batorino.aggregated$date) == 6, 3]
mean(batorino.aggregated[month(batorino.aggregated$date) == 8, 3] - batorino.aggregated[month(batorino.aggregated$date) == 6, 3])
batorino.aggregated[year(batorino.aggregated$date) < 1971, ]
batorino.aggregated[year(batorino.aggregated$date) <= 1971, ]
batorino.h3 <- batorino.h3[year(batorino.h3$date) > 1972, ]
batorino.h3$horizont <- NULL
batorino.h3$point <- NULL
batorino.h3$date <- floor_date(batorino.h3$date, "month")
batorino.aggregated <- aggregate(batorino.h3, by = list(group = batorino.h3$date), mean)
batorino.aggregated$group <- NULL
## Count nums of observation each month
obsByMonth <- sapply(1:12, function(x) dim(batorino.aggregated[month(batorino.aggregated$date) == x & complete.cases(batorino.aggregated[, c(1,3)]), ])[1])
mostVoluminousMonth <- which.max(obsByMonth)
mostVoluminousMonth
dataset <- batorino.aggregated[month(batorino.aggregated$date) == mostVoluminousMonth, ]
obsByMonth
paste0(1974, "-07-01")
getMostVoluminousMonth <- function(df) {
observationsByMonth <- sapply(1:12, function(x) dim(df[month(df$date) == x, ])[1])
return(which.max(observationsByMonth))
}
mostVoluminousMonth <- getMostVoluminousMonth(batorino.aggregated)
dataset <- batorino.aggregated[month(batorino.aggregated$date) == mostVoluminousMonth, ]
## I found that there is gap between 73 and 75 years. So it seems we can have mean mean of neighborhood months for this year
getApproximateJulyRow <- function(df, year) {
## Get observations in provided year
tmp <- df[year(df$date) == year, ]
## Get mean between june and august
july <- data.frame(rbind(colMeans(tmp[(month(tmp$date) == 06 | month(tmp$date) == 08), -1])))
july$date <- date(paste0(year, '-07-01'))
return(july)
}
approximateJuly1974 <- getApproximateJulyRow(batorino.aggregated, 1974)
approximateJuly1974
