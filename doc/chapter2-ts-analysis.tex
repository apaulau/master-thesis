\newpage

\chapter{Обработка реального временного ряда с помощью R}

\section{Вычисление основных описательных статистик} % (fold)
\label{sec:dstats}

В качестве исходных данных примем выборку из полученной от учебно-научного центра базы данных, путём отбора наблюдений в июле месяце за период с 1975 по 2012 год. Выборка представлена в приложении А в таблице А.1\todo{Ссылка}. Графически исходные данные представлены на рисунке \ref{img:input}.

\begin{figure}[ht]
\center{\includegraphics[width=1\linewidth]{../figures/temperature-ts-first-overview.pdf}}
\caption{График исходных данных.}
\label{img:input}
\end{figure}

Начнём исследование временного ряда с вычисления описательных статистик. \textbf{R} предоставляет в пакете \textit{base} такие функции как: \textit{var} --- дисперсия, \textit{mean} --- среднее, \textit{sd} --- стандартное отклонение, \textit{median} --- медиана, \textit{quantile} --- квантили, \textit{range} --- размах, \textit{min, max}. Также, в различных пакетах можно найти другие интерисующие функции, как статистические, так и математические. Но в целях удобства, компактности и контроля за функциональностью \todo[color=purple!60]{т.е. знать, что внутри} был написан модуль \textit{dstats}. Данный модуль позволяет вычислять все необходимые в данной работе описательные статистики. 

Для получения всех описательных статистик воспользуемся функцией \textit{dstats.describe}, в качестве параметра передадим вектор, содержащий наблюдаемые температуры воды. Полученные результаты представлены в таблице \ref{table:dstats}.

\input{../out/dstats.tex}

Рассмотрим подробнее некоторые полученные статистики.

Как видно из таблицы, \textit{средняя} температура в июле месяце за период с 1975 по 2012 составляет приблизительно 20°С. При этом \textit{размах} температур равен 8.3°C. \textit{Дисперсия} в данном случае равна 5.24.

\textit{Стандартное отклонение}, вычисляется функцией \textit{dstats.std.dev} оказалось равным приблизительно $2.3$. Полученное значение не велико, а значит можно сказать, что среднее значение хорошо описывает выборку. И что в среднем, температура воды озера Баторино отличается от полученной ранее \textit{средней} температуры на 2.3°C.

\textit{Коэффициент вариации}, вычисляется функцией \textit{dstats.coef.var} в нашем случае равен $26.1\%$. Из этого следует, что выборку можно счиать однородной, так как полученное значение является меньшим 33\%.

\textit{Стандартная ошибка среднего значения}, вычисляется функцией \textit{dstats.std.error}, равна $0.37$.

\textit{Коэффициент асимметрии} --- мера симметричности распределения, вычисляется функцией \textit{dstats.skew}. Полученное значение: $0.14$. Данное значение говорит о незначительном коэффициенте асимметрии выборки. То есть о том, что выборочное распределение можно считать близким к симметричному.

\textit{Cтандартная ошибка асимметрии}, вычисляется функцией \textit{dstats.std.error.skew}, равна $0.38$.

\textit{Коэффициент эксцесса}, вычисляется функцией \textit{dstats.kurtosis}, в рассматриваемом случае равен $-0.85$. Так как коэффициент эксцесса нормального распределения равен $0$, то в данном случае можно говорить о пологости пика распределения выборки по отношению к нормальному распределению. 

\textit{Стандартная ошибка коэффициента эксцесса}, вычисляется с помощью функции \textit{dstats.std.error.kurtosis}, равна $0.75$. 

По данному ранее определению тестовых статистик для коэффициента асимметрии и эксцесса, проверим значимость полученных значений для генеральной совокупности. Для этого в модуле \textit{dstats} реализованы функции \textit{dstats.test.skew} и \textit{dstats.test.kurtosis}:

Полученная тестовая статистика для коэффициента асимметрии:
\begin{equation*}
	Z_{A_S} = \frac{A_S}{SES} = 0.3630143.
\end{equation*}
Данное значение попадает под случай $\vert Z_{A_S} \vert \le 2$, а значит, выборочный коэффициент асимметрии не является значимым. Из чего, в свою очередь, следует, что по нему нельзя судить о коэффициенте асимметрии генеральной совокупности.

Полученная тестовая статистика для коэффициента эксцесса:
\begin{equation*}
	Z_K = \frac{K}{SEK} = -1.135476.
\end{equation*}
Данное значение попадает под случай $\vert Z_K \vert \le 2$, а значит, в данном случае выборочный коэффициент эксцесса не является значимым и нельзя ничего сказать о коэффициенте эксцесса генеральной совокупности.
% section dstats (end)

\section{Исследование статистических данных} % (fold)
\label{sec:analysis}

В \textbf{R} можно найти различные пакеты, позволяющие строить разнообразные гистограммы, диаграммы рассеяния, вероятностные графики, линейные графики, диаграммы диапазонов, размахов, круговые диаграммы, столбчатые диаграммы, последовательные графики и т.д., позволяющие увидеть специфику данных.

В пакет \textit{base} для визуализации входят такие функции как:
\begin{itemize}
\item \textit{plot}: общая функция для построения графиков $y(x)$;
\item \textit{barplot}: столбцовые диаграммы;
\item \textit{boxplot}: график ``ящик-с-усами'';
\item \textit{hist}: гистограммы;
\item \textit{pie}: круговые диаграммы;
\item \textit{dotchart}: точечные графики;
\item \textit{image, heatmap, contour, persp}: функции для генерации трёхмерных графиков;
\item \textit{qqnorm, qqline, qqplot}: графики квантилей;
\item \textit{pairs, coplot}: отображают на графиках несколько выборок.
\end{itemize}

С помощью функции \textit{hist} построим гистограмму для отображения вариационного ряда исходных данных. Гистограммы позволяют увидеть, как распределены значения переменных по интервалам группировки, то есть как часто переменные принимают значения из различных интервалов. А также, что бывает более важным, повзоляет сделать предположение о разновидности распределения. Полученная гистограмма отражена на рисунке \ref{img:histogram}. 
\begin{figure}[ht]
\center{\includegraphics[width=1\linewidth]{../figures/temperature-histogram.pdf}}
\caption{Гистограмма наблюдаемых температур.}
\label{img:histogram}
\end{figure}

Представленная гистограмма построена с автоматически рассчитанным количеством интервалов разбиения. Воспользуемся \textit{формулой Стерджеса} для вычисления этого количества. Из [\todo{Sturges}] количество интервалов разбиения рассчитывается по формуле:
\begin{equation}
\label{eq:sturges}
	k = \lceil log_{2}n + 1 \rceil = \lceil log_{2}38 + 1 \rceil = 7.
\end{equation}
Следует отметить, что в построенной гистограмме, на рисунке \ref{img:histogram}, получилось 9 интервалов. Данный результат обосновывается особенностями реализации функции \textit{hist}. Указанная особенность заключается в том, что эта функция вычисляет количество интервалов по формуле Стерджеса \ref{eq:sturges} и при построении интервалов пользуется принципом ``красивого'' разбиения\todo{не очень хорошее объяснение}.

По полученной гистограмме можно визуально предположить близость выборочного распределения к нормальному распределению. Исследуем подробнее данное наблюдение.

Для этого построим гистограмму с кривой плотности нормального распределения. Построенная гистограмма отображена на рисунке \ref{img:histogram_fitted}.
\begin{figure}[ht]
\center{\includegraphics[width=1\linewidth]{../figures/temperature-histogram-dnorm.pdf}}
\caption{Гистограмма наблюдаемых температур с кривой плотности нормального распределения.}
\label{img:histogram_fitted}
\end{figure}
На основании этой диаграммы уже можно сказать больше. Во-первых, здесь нагляднее представлена близость выборочного распределения к нормальному. Во-вторых, по этой гистограмме можно подтвердить или опровергнуть результаты, полученные на этапе вычисления описательных статистик в параграфе \ref{sec:dstats}.

Следует отметить согласованность полученных описательных статистик с полученной гистограммой. Во-первых, по коэффициенту асимметрии мы предположили о близости распределения к симметричному. Это подтверждается гистограммой: на ней можно заметить небольшую скошенность вправо, что также согласовывается со знаком коэффициента. Во-вторых, коэффициент эксцесса указывал на пологость пика распределения. Данное заключение подтверждается кривой плотности --- она имеет чуть более растянутую колоколобразную форму.

Другим очень часто используемым графическим способом проверки характера распределения данных является построение т.н. \textit{графиков квантилей} (\textit{Q-Q plots}, \textit{Quantile-Quantile plots}). На таких графиках изображаются квантили двух распределений --- эмпирического (т.е. построенного по анализируемым данным) и теоретически ожидаемого стандартного нормального распределения. При нормальном распределении проверяемой переменной точки на графике квантилей должны выстраиваться в прямую линию, исходящую под улом 45 градусов из левого нижнего угла графика. Графики квантилей особенно полезны при работе с небольшими по размеру совокупностями, для которых невозможно построить гистограммы, принимающие какую-либо выраженную форму.

В \textbf{R} для построения графиков квантилей можно использовать базовую функцию \textit{qqnorm()}, которая в качестве основного аргумента принимает вектор со значениями анализируемой переменной (Рисунок \ref{img:qqnorm})
\begin{figure}[ht]
\center{\includegraphics[width=1\linewidth]{../figures/temperature-qqnorm.pdf}}
\caption{График квантилей для наблюдаемых температур.}
\label{img:qqnorm}
\end{figure}
На этом графике можно визуально обнаружить аномальное положение наблюдаемых значений по отношению к нормальному распределению. В данном случае отклонения можно наблюдать на концах рассматриваемого промежутка. Остальные значения образуют отчетливую прямую. А значит, подтверждается предположение о нормальности выборочного распределения.

Далее следует проверить полученные результаты с помощью некоторых формальных тестов. Существует целый ряд статистических тестов, специально разработанных для проверки нормальности выборочного распределения. В общем виде проверяемую при помощи этих тестов нулевую гипотезу можно сформулиировать следующим образом: ``Анализируемая выборка происходит из генеральной совокупности, имеющей нормальное распределение''. Если получаемая при помощи того или иного теста вероятность ошибки $Р$ оказывается меньше некоторого заранее принятого уровня значимости (например, $0.05$), нулевая гипотеза отклоняется.

В \textbf{R} реализованы практически все имеющиеся тесты на нормальность --- либо в виде стандарных функций, либо в виде функций, входящих в состав отдельных пакетов. Примером базовой функции является \textit{shapiro.test()}, при помощи которой можно выполнить широко используемый \textit{тест Шапиро-Уилка}\todo[color=green!60]{Добавить в теорию тест Шапиро-Уилка}:
\input{../out/shapiro.tex}
В полученных результатах $W$ --- статистика Шапиро-Уилка. Вероятность ошибки $P = 0.4706 > 0.05$, а значит нулевая гипотеза не отвергается. Следовательно опровергнуть предположение на основе данного теста нельзя.

Попробуем опровегнуть наше предположение на основе проверки критерия $\chi^2$ Пирсона. Для этого воспользуемся пакетом \textit{nortest} и функцией \textit{pearson.test}:
\input{../out/pearson.tex}
В полученных результатах $P$ --- статистика $\chi^2$ Пирсона. Вероятность ошибки $P = 0.938 > 0.05$, а значит нулевая гипотеза не отвергается. Следовательно опровергнуть предположение о нормальности на основе данного теста также нельзя. Проверим критерий: примем уровень значимости $\alpha = 0,05$, тогда из таблицы распределения $\chi^2$ найдём критическое значение критерия $\chi_{кр}^2(\alpha, k) = 7,8$. Отсюда следует, что

\begin{equation*}
	\chi_{набл}^2 < \chi_{кр}^2,
\end{equation*}
где $\chi_{набл}^2 = P = 1.7895$.

А значит, нулевую гипотезу при уровне значимости $\alpha = 0,05$ не отвергаем и подтверждаем сделанный вывод на основании вычисленной вероятности ошибки. 
% section analysis (end)